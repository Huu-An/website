<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <title>Cho Thuê Sản Phẩm</title>
  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="./styles/search-page.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <style>
    /* Thiết lập cơ bản */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Quicksand', sans-serif;
      background: #F3F7FF;
      color: #333;
    }

    /* Header */
    header {
      background: #0056B3;
      /* màu xanh đậm cho thanh trên */
      color: #fff;
      padding: 15px 20px;
    }

    header .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .header-left h1 {
      font-size: 24px;
      font-weight: bold;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 30px;
    }

    .header-right .location,
    .header-right .date-range {
      font-size: 14px;
      opacity: 0.9;
    }

    /* Container chính */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Tiêu đề trang (phần form) */
    .page-title {
      font-size: 28px;
      font-weight: bold;
      margin: 20px 0;
      text-align: left;
    }

    /* Form chính */
    .form-wrapper {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 30px;
      margin-bottom: 40px;
    }

    /* Mỗi step (bước) trong form */
    .form-step {
      margin-bottom: 25px;
    }

    .step-header {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .step-number {
      width: 32px;
      height: 32px;
      background: #0056B3;
      color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 10px;
    }

    .step-title {
      font-size: 16px;
      font-weight: bold;
      color: #333;
    }

    .step-input {
      margin-left: 42px;
      /* canh để không đè lên số thứ tự */
    }

    /* Các trường input */
    .step-input input[type="text"],
    .step-input input[type="number"],
    .step-input select,
    .step-input textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      outline: none;
    }

    .step-input textarea {
      resize: vertical;
      min-height: 80px;
    }

    .step-input small {
      display: block;
      margin-top: 5px;
      color: #666;
      font-size: 12px;
    }

    /* Hình ảnh - bố trí dạng lưới */
    .image-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
    }

    .image-item {
      width: 100%;
      height: 200px;
      /* padding-bottom: 75%; */
      /* giữ tỷ lệ hình vuông hoặc 4:3 tùy chỉnh */
      background: #F0F0F0;
      border: 2px dashed #ccc;
      border-radius: 8px;
      position: relative;
      cursor: pointer;
    }

    .image-item .camera-icon {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0.5;
      font-size: 30px;
    }

    /* Bố trí giá thuê (3 trường) */
    .price-row {
      display: flex;
      gap: 20px;
      margin-bottom: 10px;
    }

    .price-row>div {
      flex: 1;
    }

    /* Nút "Đăng tin!" */
    .submit-btn {
      background: #0056B3;
      color: #fff;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }

    .image-item img {
      width: 100%;
      height: 100%;
      object-fit: fill;
    }

    .submit-btn:hover {
      background: #003F8A;
    }

    /* Footer */
    footer {
      text-align: center;
      color: #666;
      font-size: 14px;
      padding: 20px;
    }

    footer .footer-links {
      margin-top: 5px;
      font-size: 13px;
      color: #333;
    }
  </style>
</head>

<body>
  <div class="container-fluid">
    <div id="header" class="row p-3">
      <div class="col-1 px-3 mx-auto mt-3">
        <a href="/"><img src="./images/white-logo.png" alt="logo" id="logo" style="width: 60px; height: 60px;"></a>
      </div>
      <div id="search" class="col-7 d-flex-column justify-content-center">
        <div id="search-product" class="w-100">
          <div class="mt-3 row rounded rounded-5" id="in-search">
            <div class="input-group flex-nowrap" style="padding: 5px 10px;">
              <span class="input-group-text" id="addon-wrapping"
                style="background-color: white !important; border: none;"><i class="fa fa-search"></i></span>
              <input type="text" class="form-control" style="border: none !important; width: 87%;"
                placeholder="Bạn đang tìm kiếm sản phẩm gì?" aria-label="search-input" aria-describedby="addon-wrapping"
                id="input-search">
              <button class="btn text-white rounded rounded-5" style="font-size: 15px;" type="button"
                id="btn-search">Tìm kiếm</button>
            </div>
          </div>
          <div class="row text-white text-center mt-1 mb-3">
            <div class="dropdown col">
              <span class="align-middle"><i class="fa fa-location-arrow" aria-hidden="true"></i> Gần </span>
              <div class="btn-group">
                <button class="btn btn-sm dropdown-toggle text-white fw-bold" style="font-size: 16px;" type="button"
                  id="locationSelect" data-bs-toggle="dropdown" aria-expanded="false"> Mỹ Thạnh, Thủ Đức </button>
                <ul class="dropdown-menu w-100">
                  <li><a class="dropdown-item" href="#">Bình Dương</a></li>
                  <li><a class="dropdown-item" href="#">Bình Dương</a></li>
                  <li><a class="dropdown-item" href="#">Bình Dương</a></li>
                </ul>
              </div>
            </div>
            <div class="dropdown col">
              <span class="align-middle"><i class="fa fa-calendar" aria-hidden="true"></i> Thời gian thuê </span>
              <div class="btn-group">
                <button class="btn btn-sm dropdown-toggle text-white fw-bold" style="font-size: 16px;" type="button"
                  id="rentalDate" data-bs-toggle="dropdown" aria-expanded="false"> 26 thg 10, 2024 - 2 thg 11, 2024
                </button>
                <ul class="dropdown-menu w-100">
                  <li><a class="dropdown-item" href="#">Bình Dương</a></li>
                  <li><a class="dropdown-item" href="#">Bình Dương</a></li>
                  <li><a class="dropdown-item" href="#">Bình Dương</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-4">
        <div class="w-100 d-flex justify-content-center mt-3 pt-1">
          <button class="btn text-white rounded rounded-5 px-3 pt-1 pb-1" id="btn-rent">Cho thuê sản phẩm</button>
          <button class="btn">
            <img src="./images/lang-vn.jpg" alt="" style="width: 25px; height: 25px;" class="rounded rounded-circle">
            <span class="text-white">VN</span>
          </button>
          <button class="btn" id="btn-user-info">
            <i class="fa fa-user-circle text-white" aria-hidden="true" style="font-size: 1.3em;"></i>
          </button>
          <button class="btn" id="btn-cart">
            <i class="fa fa-shopping-cart text-white" aria-hidden="true" style="font-size: 1.3em;"></i>
          </button>
          <button class="btn">
            <i class="fa fa-bars text-white" aria-hidden="true" style="font-size: 1.3em;"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- Nội dung chính -->
  <div class="container">
    <h2 class="page-title">Bạn muốn cho thuê sản phẩm gì?</h2>
    <div class="form-wrapper">
      <!-- Bước 1 -->
      <div class="form-step">
        <div class="step-header">
          <div class="step-number">1</div>
          <div class="step-title">Chọn danh mục</div>
        </div>
        <div class="step-input">
          <select name="category" required>
            <option value="">-- Lựa chọn danh mục --</option>
            <option value="1">Máy ảnh</option>
            <option value="2">Điện thoại</option>
            <option value="3">Laptop</option>
            <!-- Thêm các danh mục khác -->
          </select>
        </div>
      </div>
      <!-- Bước 2 -->
      <div class="form-step">
        <div class="step-header">
          <div class="step-number">2</div>
          <div class="step-title">Tiêu đề & Mô tả</div>
        </div>
        <div class="step-input">
          <label for="title">Tiêu đề</label>
          <input type="text" id="title" name="title" placeholder="Nhập tiêu đề sản phẩm" required>
          <label for="description" style="margin-top:15px; display:block;">Mô tả sản phẩm</label>
          <textarea id="description" name="description" placeholder="Càng chi tiết càng tốt" required></textarea>
        </div>
      </div>
      <!-- Bước 3 -->
      <div class="form-step">
        <div class="step-header">
          <div class="step-number">3</div>
          <div class="step-title">Hình ảnh</div>
        </div>
        <div class="step-input">
          <small>Tải lên ít nhất 5 hình ảnh và 2 video (tỷ lệ ngang 4:3). Ảnh chân dung sẽ không được hiển thị đầy
            đủ.</small>
          <!-- Bố trí 8 khung hình (hoặc tuỳ ý) để người dùng upload -->
          <div class="image-grid" style="margin-top:15px;">
            <div class="image-item" id="icon-1">
              <span class="camera-icon">&#128247;</span>
            </div>
            <div class="image-item" id="icon-2">
              <span class="camera-icon">&#128247;</span>
            </div>
            <div class="image-item" id="icon-4">
              <span class="camera-icon">&#128247;</span>
            </div>
            <div class="image-item" id="icon-5">
              <span class="camera-icon">&#128247;</span>
            </div>
            <div class="image-item" id="icon-6">
              <span class="camera-icon">&#128247;</span>
            </div>
            <div class="image-item" id="icon-7">
              <span class="camera-icon">&#128247;</span>
            </div>
            <div class="image-item" id="icon-8">
              <span class="camera-icon">&#128247;</span>
            </div>
            <div class="image-item" id="icon-9">
              <span class="camera-icon">&#128247;</span>
            </div>
          </div>
          <!-- Input file thật (ẩn hoặc tuỳ ý) -->
          <!-- <input type="file" name="images[]" multiple style="margin-top:10px;">-->
          <input type="file" id="fileInput" accept="image/*" style="display: none;">
        </div>
      </div>
      <!-- Bước 4 -->
      <div class="form-step">
        <div class="step-header">
          <div class="step-number">4</div>
          <div class="step-title">Giá</div>
        </div>
        <div class="step-input">
          <div class="price-row">
            <div>
              <label for="price1">Giá cho 1 ngày</label>
              <input type="number" id="price1" name="price1" placeholder="VNĐ" required>
            </div>
            <div>
              <label for="price3">Giá cho 3 ngày</label>
              <input type="number" id="price3" name="price3" placeholder="VNĐ" required>
            </div>
            <div>
              <label for="price7">Giá cho 7 ngày</label>
              <input type="number" id="price7" name="price7" placeholder="VNĐ" required>
            </div>
          </div>
          <small>Bạn có thể cung cấp giá thấp hơn cho các lần thuê dài ngày. Giá thuê sẽ tính theo mức giá thấp
            nhất.</small>
        </div>
      </div>
      <!-- Bước 5 -->
      <div class="form-step">
        <div class="step-header">
          <div class="step-number">5</div>
          <div class="step-title">Có thể giao sản phẩm ở đâu?</div>
        </div>
        <div class="step-input">
          <input type="text" name="delivery" placeholder="Nhập địa chỉ giao hàng" required>
        </div>
      </div>
      <!-- Bước 6 -->
      <div class="form-step">
        <div class="step-header">
          <div class="step-number">6</div>
          <div class="step-title">Điều khoản hủy bỏ</div>
        </div>
        <div class="step-input">
          <select name="cancellation" required>
            <option value="">-- Chọn điều khoản hủy --</option>
            <option value="easy">Dễ (trước 2 ngày: 100% hoàn lại, trước 1 ngày: 50%)</option>
            <option value="medium">Trung bình</option>
            <option value="hard">Khó</option>
          </select>
          <small>Dễ - Hủy trước 2 ngày so với thời gian thuê, 100% hoàn lại. Trước 1 ngày, 50% hoàn lại.</small>
        </div>
      </div>
      <!-- Bước 7 -->
      <div class="form-step">
        <div class="step-header">
          <div class="step-number">7</div>
          <div class="step-title">Giá trị của mặt hàng</div>
        </div>
        <div class="step-input">
          <input type="number" name="product_value" placeholder="Nếu bán ngay hôm nay trên Marketplace, giá bao nhiêu?"
            required>
        </div>
      </div>
      <!-- Nút Đăng tin -->
      <button type="submit" class="submit-btn" id="btn-post">Đăng tin!</button>
    </div>
  </div>
  <footer id="footer" class="row text-white column-gap-3 w-100 mx-0" style="padding: 5% 12% 12% 5%;">
    <div class="col">
      <h5 class="mb-3">Giới thiệu TER</h5>
      <p class="mt-3 mb-3">Thuê Nhanh - thuê gì cũng có. Hệ thống cho thuê đồ công nghệ độc đáo hàng đầu Việt Nam </p>
      <img src="./images/bct.png" class="mt-3" id="img-bct">
    </div>
    <div class="col">
      <h5 class="mb-3">Liên kết</h5>
      <div class="mt-3">
        <a href="/" style="text-decoration: none;" class="text-white">- Giới thiệu</a> </br>
        <a href="/" style="text-decoration: none;" class="text-white">- Liên hệ</a> </br>
        <a href="/" style="text-decoration: none;" class="text-white">- Tin tức</a> </br>
        <a href="/" style="text-decoration: none;" class="text-white">- Hướng dẫn sử dụng</a> </br>
        <a href="/" style="text-decoration: none;" class="text-white">- Điều khoản sử dụng</a> </br>
        <a href="/" style="text-decoration: none;" class="text-white">- Qui trình thuê</a> </br>
        <a href="/" style="text-decoration: none;" class="text-white">- Đặt cọc</a> </br>
        <a href="/" style="text-decoration: none;" class="text-white">- Lợi ích của việc thuê với mua</a> </br>
      </div>
    </div>
    <div class="col">
      <h5 class="mb-3">Thông tin liên hệ</h5>
      <div class="row">
        <table>
          <tr>
            <td class="px-3" style="font-size: 1.3em;"><i class="fa fa-map-marker" aria-hidden="true"></i></td>
            <td>
              <p class="mb-0">Lô E2a-7, Đường D1, Đ. D1, Long Thạnh Mỹ, Thành Phố Thủ Đức, Hồ Chí Minh</p>
            </td>
          </tr>
          <tr>
            <td class="px-3" style="font-size: 1.3em;"><i class="fa fa-phone" aria-hidden="true"></i></td>
            <td>
              <a class="mb-0 text-white" href="tel:+84 0912345678" style="text-decoration: none;">0912345678</a>
            </td>
          </tr>
          <tr>
            <td class="px-3" style="font-size: 1.3em;"><i class="fa fa-envelope" aria-hidden="true"></i></td>
            <td>
              <a class="mb-0 text-white" href="mailto:ter@gmail.com" style="text-decoration: none;">ter@gmail.com</a>
            </td>
          </tr>
        </table>
      </div>
    </div>
    <div class="col">
      <h5 class="mb-3">Fanpage</h5>
      <div>
        <a href="" style="text-decoration: none;" class="text-white display-6"><i class="fa fa-facebook-official"
            aria-hidden="true"></i></a>
      </div>
    </div>
  </footer>
  <script>
    const checkAuthen = () => {
      if (document.cookie == "") {
        window.location.href = "/login.html";
      }
    };

    checkAuthen();
    const uploadedFiles = {};

    document.querySelectorAll('.image-item').forEach(item => {
      item.addEventListener('click', function () {
        const fileInput = document.getElementById('fileInput');
        fileInput.dataset.targetId = this.id;
        fileInput.click();
      });
    });

    document.getElementById('fileInput').addEventListener('change', function (event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const targetId = event.target.dataset.targetId;
          const targetElement = document.getElementById(targetId);
          targetElement.innerHTML = `<img src="${e.target.result}" alt="Uploaded Image">`;
        };
        reader.readAsDataURL(file);
      }
    });

    document.querySelector("#btn-post").addEventListener("click", (e) => {
      const danhMuc = document.querySelector("select[name=category]");
      const tieuDe = document.querySelector("#title");
      const moTa = document.querySelector("#description");
      const hinhAnh = document.querySelectorAll(".image-item img");
      const gia1 = document.querySelector("#price1");
      const gia3 = document.querySelector("#price3");
      const gia7 = document.querySelector("#price7");
      const diaChi = document.querySelector("input[name=delivery]");
      const dieuKhoanHuy = document.querySelector("select[name=cancellation]");
      const giaTri = document.querySelector("input[name=product_value]");
      
      // Thu thập các ảnh đã upload (chỉ lấy những ảnh có src dạng base64)
      let imagesArray = [];
      document.querySelectorAll(".image-item img").forEach(img => {
        if (img.src && img.src.startsWith("data:image/")) {
          imagesArray.push(img.src);
        }
      });

      const danhMucSelected = danhMuc.options[danhMuc.selectedIndex].text;
      const tieuDeSelected = tieuDe.value;
      const moTaSelected = moTa.value;
      const gia1Value = gia1.value;
      const gia3Value = gia3.value;
      const gia7Value = gia7.value;
      const diaChiSelected = diaChi.value;
      const dieuKhoanHuySelected = dieuKhoanHuy.selectedIndex;
      const giaTriValue = giaTri.value;
      console.log(imagesArray);
      if (danhMuc.selectedIndex == 0 || tieuDe.value == "" || moTa.value == "" ||
        gia1.value == "" || gia3.value == "" || gia7.value == "" || diaChi.value == "" ||
        dieuKhoanHuy.selectedIndex == 0 || giaTri.value == "") {
        alert("Vui lòng không bỏ trống bất kỳ trường thông tin nào");
      } else {
        body = {
          "category": danhMucSelected,
          "title": tieuDeSelected,
          "description": moTaSelected,
          "images": imagesArray,
          "video": [
            "string"
          ],
          "rent_price": [
            {
              "price": gia1Value,
              "time": "for_1_days"
            },
            {
              "price": gia3Value,
              "time": "for_3_days"
            },
            {
              "price": gia7Value,
              "time": "for_7_days"
            }
          ],
          "address": diaChiSelected,
          "cancel_policy": dieuKhoanHuySelected - 1,
          "sell_price": giaTriValue
        }

        const rentAPI = async () => {
          const rawResponse = await fetch('http://157.66.81.167:8000/rent/create', {
            method: 'POST',
            headers: {
              'Accept': 'application/json',
              'Content-Type': 'application/json',
              'Authorization': 'Bearer ' + document.cookie.replace("token=", "")
            },
            body: JSON.stringify(body)
          });
          const content = await rawResponse.json();
          console.log(content);
          if (content.code == 200) {
            alert("Thêm sản phẩm thành công");
            window.location.href = "/import.html";
          } else {
            alert("Thêm sản phẩm không thành công");
          }
        };
        rentAPI();
      }
    });
  </script>
</body>

</html>